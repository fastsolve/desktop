#!/bin/bash

HOSTID=$(ifconfig eth0 | grep HWaddr | perl -pe "s/.+HWaddr ([\w:]+)/\$1/g ; s/://g")
if [[ ! -d /usr/local/MATLAB/$MATLAB_VERSION/sys/java && -d /usr/lib/jvm/java-8-openjdk-amd64/jre ]]; then
    export MATLAB_JAVA=/usr/lib/jvm/java-8-openjdk-amd64/jre
fi

[[ -z "$MATLAB_VERSION" ]] || \
    (mkdir -p $HOME/.matlab/$MATLAB_VERSION && \
     ln -s -f $HOME/.config/matlab/matlab.prf $HOME/.matlab/$MATLAB_VERSION && \
     grep -q $HOSTID /usr/local/MATLAB/$MATLAB_VERSION/licenses/* || \
     /usr/local/MATLAB/$MATLAB_VERSION/bin/activate_matlab.sh) && \
     /usr/local/MATLAB/$MATLAB_VERSION/bin/matlab $@
